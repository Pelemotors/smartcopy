/**
 * סקריפט להעלאת מאמרים מ-LAYLA.txt ל-Supabase
 * הרצה: node scripts/upload_articles.js
 */

const fs = require('fs');
const path = require('path');

// קריאת התוכן מהקובץ
const contentPath = path.join(__dirname, '../knowlede_base/LAYLA.txt');
const content = fs.readFileSync(contentPath, 'utf-8');

// חלוקה למאמרים
const articles = [
  {
    title_he: 'הבנת שינה של תינוקות ופעוטות',
    slug: 'understanding-baby-sleep',
    excerpt_he: 'מדריך מקיף להבנת מחזורי שינה, סוגי שינה וסימני עייפות אצל תינוקות ופעוטות',
    content_he: `<h2>מחזורי שינה בגיל 0–3 שנים</h2>
<p>תינוקות נולדים עם מחזורי שינה קצרים של 40–60 דקות, רובם בשינה REM (שינה חלומית). במהלך החודשים הראשונים, השינה אינה רציפה והם מתעוררים לצורך אוכל או נוחות.</p>
<ul>
<li><strong>0–3 חודשים:</strong> התינוק ישן 14–17 שעות ביום, בעיקר ביום ולילה מתחלף.</li>
<li><strong>3–6 חודשים:</strong> מתפתחת יכולת לישון ליותר שעות רצופות בלילה.</li>
<li><strong>6–12 חודשים:</strong> בדרך כלל 2–3 שינה יום, 11–12 שעות לילה.</li>
<li><strong>1–3 שנים:</strong> שינה יום 1–2 פעמים, לילה של 10–12 שעות.</li>
</ul>
<p><strong>טיפ מעשי:</strong> תינוק שמראה סימנים של עייפות (שפשוף עיניים, פיה פותח או רוטט, מרובד או מזגזג) צריך ללכת לישון מיד – עייפות יתר מקשה על הירדמות.</p>

<h2>הבדלים בין שינה REM לשינה עמוקה</h2>
<p><strong>שינה REM:</strong> פעילה, חלומית, קצב לב נשימתי משתנה, קורה בעיקר בשליש הראשון של הלילה אצל תינוקות.</p>
<p><strong>שינה עמוקה (Non-REM):</strong> מרגיעה, מאפשרת התחדשות פיזית.</p>
<p><strong>טיפ מעשי:</strong> אם התינוק מתעורר בלילה – לעיתים מדובר במחזור שינה קצר של REM. קרבה, חיבוק או לחישה מרגיעה יכולים לעזור לו לחזור לשינה.</p>

<h2>סימנים שהילד עייף או זקוק למנוחה</h2>
<ul>
<li>שפשוף עיניים, חוסר ריכוז</li>
<li>קריצה או התכנסות על עצמו</li>
<li>בכי או עצבנות חריגה</li>
</ul>
<p><strong>טיפ מעשי:</strong> זיהוי מוקדם של עייפות מאפשר להימנע מהתעוררויות רבות בלילה, ובכך מייצר שינה רציפה וטובה יותר.</p>`,
    category_slug: 'wake-ups',
    published: true,
  },
  {
    title_he: 'בעיות שינה נפוצות',
    slug: 'common-sleep-problems',
    excerpt_he: 'מדריך לזיהוי וטיפול בבעיות שינה נפוצות: רגרסיות שינה, עייפות יתר והתעוררויות ליליות',
    content_he: `<h2>רגרסיות שינה</h2>
<p>רגרסיות שינה הן תקופות שבהן תינוק שהיה רגיל לישון טוב בלילה, מתחיל להתעורר יותר או מתקשה להירדם. הן נפוצות בגילאים: 4 חודשים, 8–10 חודשים, 12 חודשים ולעיתים סביב גיל 2.</p>
<p><strong>למה זה קורה:</strong> שינויים בהתפתחות, צמיחה, למידה של מיומנויות חדשות (למשל לזחול או ללכת), חיסונים או שינויים בסביבה.</p>
<p><strong>טיפ מעשי:</strong></p>
<ul>
<li>שמירה על טקסי שינה עקביים מסייעת לילד להרגיש בטוח.</li>
<li>אל תנסי "לתקן" הכל – לעיתים מספיק סבלנות והקפדה על שגרה.</li>
</ul>

<h2>עייפות יתר</h2>
<p>תינוקות או פעוטות שמקבלים מעט מדי שינה או שנכנסים למצב של עייפות יתר, מתקשים להירדם, בוכים הרבה, או מתעוררים תכופות בלילה.</p>
<p><strong>טיפ מעשי:</strong></p>
<ul>
<li>הכירי את סימני העייפות של הילד וזמני השינה המומלצים לגילו.</li>
<li>שמירה על שגרה קבועה של ערות ושינה עוזרת להימנע מעייפות יתר.</li>
</ul>

<h2>התעוררויות ליליות והפרעות שינה</h2>
<p><strong>בכי בלילה ללא סיבה נראית לעין:</strong> לעיתים תינוקות מתעוררים מסיבות פיזיולוגיות כמו רעב או חיתול רטוב.</p>
<p><strong>פחדי לילה (Night Terrors):</strong> נפוצים בגילאי 2–4 שנים. הילד נראה מפוחד אבל אינו בהכרה מלאה, ולא זוכר את האירוע בבוקר.</p>
<p><strong>קשיי הירדמות:</strong> קשורים לעיתים לגורמי תלות (מוצץ, חיבוק, הנקה).</p>
<p><strong>טיפ מעשי:</strong></p>
<ul>
<li>הקפדה על סביבה רגועה, אור נמוך ורעש לבן יכולה להפחית התעוררויות.</li>
<li>במקרים של פחדי לילה – יש להעניק בטחון ולחכות שהפחד יעבור, בלי לגרום למצוקה נוספת.</li>
</ul>`,
    category_slug: 'wake-ups',
    published: true,
  },
  {
    title_he: 'טקסי שינה ושגרה',
    slug: 'bedtime-routines',
    excerpt_he: 'כיצד ליצור טקס שינה קצר, עקבי ומרגיע, ולבנות שגרות יום שתורמות לשינה טובה',
    content_he: `<h2>איך ליצור טקס שינה קצר, עקבי ומרגיע</h2>
<p>טקס שינה הוא רצף פעולות קבוע שמסמן לילד שהגיע זמן השינה. טקס עקבי משרה תחושת ביטחון ומקל על ההירדמות.</p>
<p><strong>דוגמאות לטקס קצר (10–15 דקות):</strong></p>
<ol>
<li>אמבטיה חמה או חיטוי פנים ידיים</li>
<li>ללבוש פיג'מה נוחה</li>
<li>קריאת ספר קצר או שיר שקט</li>
<li>חיבוק, ליטוף או לחישה מרגיעה</li>
<li>כיבוי אור, השמעת רעש לבן או מוסיקה רגועה</li>
</ol>
<p><strong>טיפ מעשי:</strong> הקפידי על סדר קבוע – גם אם זה דורש כמה ניסיונות, הילד ילמד לזהות את האותות ולהירדם ביתר קלות.</p>

<h2>שגרות יום והשפעתן על שינה</h2>
<ul>
<li>שינה יום מסודרת מונעת עייפות יתר בלילה.</li>
<li>ארוחות והפעלות בזמן קבוע מסייעים לייצב את מחזור השינה.</li>
<li>סיורים קצרים בחוץ ביום עוזרים להסדיר את השעון הביולוגי.</li>
</ul>
<p><strong>טיפ מעשי:</strong> צלילי יום קבועים (פעילות, אוכל, מנוחה) מסייעים לתינוק או לפעוט להבדיל בין זמן ערות לזמן שינה.</p>

<h2>מעבר חדר / מיטה חדשה – טיפים למעבר קל</h2>
<p>מעבר מיטה או חדר חדש יכול לשבש את השינה אם הילד מרגיש חוסר ביטחון.</p>
<p><strong>טיפים למעבר:</strong></p>
<ul>
<li>הכניסי פריטים מוכרים מהחדר הקודם (שמיכה, צעצוע אהוב).</li>
<li>השאירי אור לילה עד שהילד מסתגל.</li>
<li>התחילי בהכנסה הדרגתית: זמן קצר בחדר החדש במהלך היום לפני השינה.</li>
<li>שמירה על הטקס הקבוע גם בחדר החדש.</li>
</ul>`,
    category_slug: 'bedtime',
    published: true,
  },
  {
    title_he: 'גורמי תלות והשפעתם על השינה',
    slug: 'sleep-dependencies',
    excerpt_he: 'כיצד לטפל בגורמי תלות כמו מוצץ, הנקה וחפצים אהובים, ולהפחית תלות בהדרגה',
    content_he: `<h2>מוצץ, הנקה וחפצים אהובים והשפעתם על השינה</h2>
<p>גורמי תלות יכולים לסייע לילד להירגע, אך לעיתים מקשים על שינה רציפה:</p>
<ul>
<li><strong>מוצץ:</strong> מספק ביטחון ומקל על הירדמות, אך אם הילד מתעורר בלילה ומאבד אותו, יתעורר שוב.</li>
<li><strong>הנקה לפני השינה:</strong> יכולה להיות מרגיעה, אך עלולה ליצור תלות שגורמת להתעוררויות מרובות בלילה.</li>
<li><strong>צעצוע או שמיכה אהובה:</strong> מעניקים לילד תחושת ביטחון ועוזרים לו לחזור לשינה באופן עצמאי.</li>
</ul>
<p><strong>טיפ מעשי:</strong> בחרי גורם אחד או שניים בלבד לטקס השינה, ושמרי עליו עקביות.</p>

<h2>הפחתת תלות בהדרגה והקניית ביטחון</h2>
<p>אם רוצים להפחית תלות:</p>
<ol>
<li><strong>שלבי:</strong> החליפי תלויות מסוימות בהדרגה (למשל מהנקה מלאה להנקה קצרה, או שימוש במוצץ חלקי).</li>
<li><strong>תמיכה רגשית:</strong> חיבוק, לחישה או נגיעה ידידותית בעת ההרדמות מספקת ביטחון.</li>
<li><strong>שגרה עקבית:</strong> כל שינוי נעשה בזמן קבוע עם טקסי הרגעה קבועים.</li>
</ol>
<p><strong>טיפ מעשי:</strong> גם אם הילד בוכה, שמרי על עקביות – בטחון ונחישות מורים לו שהשינה היא סביבה בטוחה.</p>`,
    category_slug: 'weaning',
    published: true,
  },
  {
    title_he: 'חינוך לשינה בריאה',
    slug: 'healthy-sleep-education',
    excerpt_he: 'שיטות ליווי שינה, עידוד שינה עצמאית והשפעת ההורים על איכות השינה של הילד',
    content_he: `<h2>שיטות ליווי שינה</h2>
<p>שיטות ליווי שינה מסייעות להורים להדריך את הילד להירדם ולישון בצורה רגועה, מבלי לגרום למצוקה גדולה:</p>
<ul>
<li><strong>שיטת "לילה טוב":</strong> ליווי הדרגתי שמלמד את הילד להירדם בעצמו, עם תמיכה רגשית קבועה.</li>
<li><strong>שיטות הרגעה הדרגתית:</strong> ישיבה ליד המיטה והפחתה הדרגתית של המעורבות.</li>
<li><strong>שיטה "ללא בכי":</strong> הקפדה על טקס קבוע והמתנה עד שהילד יירדם בעצמו.</li>
</ul>
<p><strong>טיפ מעשי:</strong> בחרי שיטה שמתאימה לאופי הילד ולערכים שלך כהורה, והקפידי על עקביות כדי לקבל תוצאות טובות.</p>

<h2>שינה עצמאית – איך לעודד בלי לגרום למצוקה</h2>
<ul>
<li>התחילי בצעדים קטנים: חפץ אהוב, אור לילה, לחישת הרגעה קלה.</li>
<li>עשי ניסויים קטנים בזמן יום – לדוגמה, הרדמת הילד לבד לזמן קצר ביום, כדי לראות איך הוא מסתגל.</li>
<li>שמרי על חום ותמיכה רגשית – הילד צריך להרגיש בטוח גם כשהוא לומד לישון לבד.</li>
</ul>
<p><strong>טיפ מעשי:</strong> אל תתייאשי אם לוקח זמן. עידוד הדרגתי ושגרה עקבית מחזקים את הביטחון העצמי של הילד ומאפשרים שינה רציפה יותר.</p>

<h2>השפעת ההורים על השינה</h2>
<ul>
<li><strong>רוגע ואמון:</strong> התנהגות רגועה והקפדה על עקביות מסייעת לילד להרגיש בטוח.</li>
<li><strong>סבלנות:</strong> שינויים בדפוסי השינה לוקחים זמן – גם אם הילד בוכה, חשוב להישאר רגועים ועקביים.</li>
<li><strong>תיאום בין הורים:</strong> חשוב ששני ההורים יהיו עם אותה אסטרטגיה כדי למנוע בלבול אצל הילד.</li>
</ul>
<p><strong>טיפ מעשי:</strong> שמירה על מסגרת עקבית ושפת גוף רגועה מסייעת לילד ללמוד שינה בריאה ומעודדת ביטחון עצמי.</p>`,
    category_slug: 'continuous-sleep',
    published: true,
  },
];

// פונקציה להעלאת מאמר
async function uploadArticle(article) {
  try {
    // קבלת category_id לפי slug
    const categoryResponse = await fetch(
      `${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/admin/blog/categories?slug=${article.category_slug}`
    );
    
    // אם אין API לקטגוריות, נשתמש ב-slug ישירות
    // נצטרך ליצור API route לקטגוריות או להשתמש ב-Supabase ישירות
    
    const response = await fetch(
      `${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/admin/blog`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          // TODO: צריך להוסיף authentication token
        },
        body: JSON.stringify({
          ...article,
          published_at: new Date().toISOString(),
          author_name: 'מעבדת שיניים',
        }),
      }
    );

    if (response.ok) {
      const data = await response.json();
      console.log(`✅ המאמר "${article.title_he}" הועלה בהצלחה`);
      return data;
    } else {
      const error = await response.json();
      console.error(`❌ שגיאה בהעלאת "${article.title_he}":`, error);
      return null;
    }
  } catch (error) {
    console.error(`❌ שגיאה בהעלאת "${article.title_he}":`, error.message);
    return null;
  }
}

// הרצה
async function main() {
  console.log('🚀 מתחיל להעלות מאמרים...\n');
  
  for (const article of articles) {
    await uploadArticle(article);
    // המתנה קצרה בין כל מאמר
    await new Promise(resolve => setTimeout(resolve, 500));
  }
  
  console.log('\n✨ סיום העלאת המאמרים!');
}

// הרצה רק אם הקובץ נקרא ישירות
if (require.main === module) {
  main().catch(console.error);
}

module.exports = { articles, uploadArticle };

